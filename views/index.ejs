<!DOCTYPE html>
<html lang="es">
  <%-include('partials/head') %>
  <body class="colorNuevo5">
    <%-include('partials/header') %>
    <% if(!user) { %>
    <div class="d-flex align-items-center justify-content-center vh-90" >
      <div>
        <h1 class="text-center indexTitle" >Clefchamp</h1>
        <h2 class="text-center"> Plataforma de aprendizaje musical mediante gamificación</h2>
        <div class="d-flex justify-content-center mt-5">
          <a href="/play/atrapado/trial"><button class="cancelButton me-5">Prueba de nivel</button></a>
          <a href="/moreInformation"><button class="acceptButton">Saber más</button></a>
        </div>
      </div>
    </div>
    <% } else { %> 
    <div class="vh-90">
      <!-- User Profile Section -->
      <div class="container-fluid px-4">
        <div class="row">
          <div class="col-8">
            <div class="bg-15 rounded-4 p-3">
              <div class="row align-items-center">
                <div class="col-3">
                  <div class="ratio ratio-1x1">
                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="background-color: <%=user.bgColor%>;">  
                      <a href="/users/profile"><img src="/images/svg/<%=user.path%>" class="userIcon"></a>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <h2 class="mb-3"><%=user.name%></h2>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-white">Experiencia</span>
                    
                    <span class="text-white"><%=user.experience%>/<%=user.experience + user.experienceToNext%></span>
                  </div>
                  <div class="progress" style="height: 2em; background-color: rgba(255,255,255,0.1)">
                    <% let percentage = ((user.experience)/(user.experience + user.experienceToNext))*100 %>
                    <div id="levelBar" class="progress-bar bg-success" style="width: <%=percentage%>%">
                      <h5 class="mt-1">Nivel <%=user.level%></h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="bg-65 rounded-4 p-3 h-100">
              <h3 class="text-white mb-3">¡Ayúdanos a mejorar!</h3>
              <p class="text-white mb-4">Tu opinión es muy importante para nosotros. Completa nuestra encuesta y ayúdanos a hacer Clefchamp aún mejor.</p>
              <a href="https://docs.google.com/forms/d/e/1FAIpQLSfMAmHEKpRAzRuneOTOZ3GfJg7Dhug9ATXDRgAvapuUX0wZEQ/viewform?usp=header" target="_blank" class="d-block">
                <button class="acceptButton w-100">Completar encuesta</button>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="container-fluid px-4 mt-4">
        <div class="row g-3">
          <!-- Left Column - Navigation -->
          <div class="col-3">
            <div class="bg-15 rounded-4 p-4 h-100">
              <div class="d-flex flex-column gap-3">
                <a href="/users/globalRanking" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-3 hover-effect d-flex align-items-center">
                    <!-- <img src="/images/icons/trophy.svg" class="me-3" style="width: 2em"> -->
                    <span class="fs-5 text-dark">Ranking global</span>
                  </div>
                </a>
                <a href="/users/stats" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-3 hover-effect d-flex align-items-center">
                    <!-- <img src="/images/icons/chart.svg" class="me-3" style="width: 2em"> -->
                    <span class="fs-5 text-dark">Estadísticas</span>
                  </div>
                </a>
                <a href="/users/profile" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-3 hover-effect d-flex align-items-center">
                    <!-- <img src="/images/icons/user.svg" class="me-3" style="width: 2em"> -->
                    <span class="fs-5 text-dark">Perfil</span>
                  </div>
                </a>
                <a href="/users/friends" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-3 hover-effect d-flex align-items-center">
                    <!-- <img src="/images/icons/friends.svg" class="me-3" style="width: 2em"> -->
                    <span class="fs-5 text-dark">Amigos</span>
                  </div>
                </a>
              </div>
            </div>
          </div>
          <!-- Right Column - Game Options -->
          <div class="col">
            <div class="bg-15 rounded-4 p-4 h-100">
              <h2 class="mb-4">¡Hora de jugar!</h2>
              <div class="d-flex flex-column gap-3">
                <a href="/play/selectGame" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-4 hover-effect">
                    <div class="d-flex align-items-center">
                      <!-- <img src="/images/icons/play.svg" class="me-3" style="width: 2.5em"> -->
                      <div>
                        <h3 class="mb-1 text-black">Nueva partida</h3>
                        <p class="mb-0 text-muted">Comienza una nueva aventura musical</p>
                      </div>
                    </div>
                  </div>
                </a>
                <a id="lastPlayed" class="text-decoration-none">
                  <div class="bg-35 rounded-4 p-4 hover-effect">
                    <div class="d-flex align-items-center">
                      <!-- <img src="/images/icons/history.svg" class="me-3" style="width: 2.5em"> -->
                      <div>
                        <h3 class="mb-1 text-black">Última partida</h3>
                        <p id="lastPlayedBtn" class="mb-0 text-muted">Continúa donde lo dejaste</p>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Music player stays at the bottom -->
      <div class="music-player bg-15 mt-4 p-3">
        <div class="container-fluid">
          <div class="row align-items-center">
            <!-- Song Info -->
            <div class="col-3">
              <h4 id="songTitle" class="mb-0">Song Title</h4>
              <p id="songArtist" class="mb-0 text-muted">Song Artist</p>
            </div>
            
            <!-- Controls -->
            <div class="col-6">
              <div class="d-flex justify-content-center align-items-center gap-4 mb-2">
                <img id="prevBtn" src="/images/icons/skip-previous.svg" class="musicIcons">
                <img id="rewindBackBtn" src="/images/icons/rewind-5-back.svg" class="musicIcons">
                <img id="playPauseBtn" src="/images/icons/play.svg" class="musicIcons" style="width: 2.5em">
                <img id="rewindForwardBtn" src="/images/icons/rewind-5-forward.svg" class="musicIcons">
                <img id="nextBtn" src="/images/icons/skip-next.svg" class="musicIcons">
              </div>
              <input id="progressBar" class="musicControl w-100" type="range" value="0" step="1" max="100">
            </div>
            
            <!-- Volume -->
            <div class="col-3">
              <div class="d-flex align-items-center justify-content-end gap-2">
                <img id="soundSvg" src="/images/icons/volume-small.svg" class="musicIcons">
                <input id="volumeControl" class="musicControl" type="range" value="33" step="1" max="100" style="width: 100px">
              </div>
            </div>
          </div>
        </div>
      </div>
      <audio id="audio"></audio>
    </div> 
    <% } %>
    <%-include('partials/footer') %>
    <% if(user) { %> <script src="/javascripts/musicPlayer.js"></script> <% } %>
    <script>
      $(document).ready(function() {
        let difficulty = localStorage.getItem("lastPlayed") || "EASY"; // Valor por defecto si es null
        
        // Configurar enlace dinámico
        $("#lastPlayed").attr("href", "/play/atrapado/" + difficulty.toLowerCase());
        
        // Determinar el texto de la dificultad
        let dificultad = "Fácil"; // Valor por defecto
        if (difficulty === "NORMAL") dificultad = "Normal";
        if (difficulty === "HARD") dificultad = "Difícil";
        
        // Actualizar el texto del botón
        $("#lastPlayedBtn").text("Jugar a Atrapa-do " + dificultad);
      })

    </script>
  </body>
</html>